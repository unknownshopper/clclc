rules_version = '2'

service cloud.firestore {
  match /databases/{database}/documents {
    match /evaluaciones/{document} {
      // Lecturas:
      // - Público/otros roles: solo 'publicado'
      // - Admin: puede leer TODO (incluye borradores)
      allow read: if resource.data.estadoPublicacion == 'publicado'
                  || (request.auth != null
                      && request.auth.token.email == 'unknownshoppersmx@gmail.com');

      // Escrituras: solo la cuenta admin
      allow create, update, delete: if request.auth != null
                                    && request.auth.token.email == 'unknownshoppersmx@gmail.com';
    }

    // Denegar todo lo demás
    match /{document=**} {
      allow read, write: if false;
    }
  }
}