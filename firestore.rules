rules_version = '2'

service cloud.firestore {
  match /databases/{database}/documents {
    // Colección de evaluaciones
    match /evaluaciones/{document} {
      // Lecturas:
      // - Público: solo evaluaciones publicadas
      // - Autenticados (admin): pueden leer TODO (incluye borradores y documentos antiguos sin campo)
      allow read: if resource.data.estadoPublicacion == 'publicado'
                  || request.auth != null;

      // Escrituras: solo la cuenta admin
      allow create, update, delete: if request.auth != null
                                    && request.auth.token.email == 'unknownshoppersmx@gmail.com';
    }

    // Denegar todo lo demás por defecto
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
